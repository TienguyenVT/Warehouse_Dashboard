{"ast":null,"code":"import _objectSpread from\"C:/Documents/warehouse-dashboard/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// File: Dashboard.js\n// Mô tả: Component React chính hiển thị dashboard quản lý kho hàng.\n// Chức năng: Quản lý trạng thái, lọc, thống kê, hiển thị lưới kệ, chi tiết kệ, và đồng bộ dữ liệu mock cho toàn bộ hệ thống.\nimport React,{useState,useEffect}from'react';import'./Dashboard.css';import ShelfGrid from'../components/ShelfGrid/ShelfGrid';import FilterPanel from'../components/FilterPanel/FilterPanel';import ShelfDetail from'../components/ShelfDetail/ShelfDetail';import{shelf}from'../utils/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Dashboard=_ref=>{let{user,onLogout}=_ref;const[shelves,setShelves]=useState([]);const[filteredShelves,setFilteredShelves]=useState([]);const[selectedShelf,setSelectedShelf]=useState(null);const[filters,setFilters]=useState({tier:'all',status:'all'});const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Loại bỏ hàm calculateStats vì không cần thiết nữa\n// Áp dụng bộ lọc, an toàn với dữ liệu thiếu\nconst applyFilters=(shelfList,currentFilters)=>{return(Array.isArray(shelfList)?shelfList:[]).filter(shelf=>{const tierMatch=currentFilters.tier==='all'||String(shelf.tier)===String(currentFilters.tier);const statusMatch=currentFilters.status==='all'||shelf.status&&shelf.status===currentFilters.status;return tierMatch&&statusMatch;});};// Load dữ liệu ban đầu\nuseEffect(()=>{let isMounted=true;const loadData=async()=>{try{setLoading(true);const data=await shelf.fetchAll();if(!isMounted)return;setShelves(data);const filtered=applyFilters(data,filters);setFilteredShelves(filtered);}catch(err){if(isMounted)setError(err.message);}finally{if(isMounted)setLoading(false);}};loadData();return()=>{isMounted=false;};},[filters]);// Subscribe to shelf updates (mock)\nuseEffect(()=>{let unsub=null;const subscribe=async()=>{unsub=await shelf.subscribeToUpdates(update=>{setShelves(prevShelves=>{const newShelves=prevShelves.map(s=>s.tier===update.tier&&s.tray===update.tray?_objectSpread(_objectSpread({},s),update):s);const filtered=applyFilters(newShelves,filters);setFilteredShelves(filtered);return newShelves;});});};subscribe();return()=>{if(unsub)unsub();};},[filters]);// Xử lý thay đổi bộ lọc\nconst handleFilterChange=(type,value,newFilters)=>{// newFilters có thể được truyền từ FilterPanel, nếu không thì tự tạo\nconst nextFilters=newFilters||_objectSpread(_objectSpread({},filters),{},{[type]:value});setFilters(nextFilters);const filtered=applyFilters(shelves,nextFilters);setFilteredShelves(filtered);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",role:\"status\",children:\"\\u0110ang t\\u1EA3i d\\u1EEF li\\u1EC7u...\"});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"error\",role:\"alert\",children:[\"L\\u1ED7i: \",error]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-header\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"dashboard-title\",children:\"Warehouse Dashboard\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"user-name\",children:(user===null||user===void 0?void 0:user.username)||'Admin'}),/*#__PURE__*/_jsx(\"button\",{className:\"logout-button\",onClick:onLogout,children:\"\\u0110\\u0103ng xu\\u1EA5t\"})]})]}),\"      \",/*#__PURE__*/_jsx(FilterPanel,{tiers:[...new Set(shelves.map(s=>s.tier))].sort(),statuses:['HIGH','MEDIUM','EMPTY'],filters:filters,onFilterChange:handleFilterChange}),/*#__PURE__*/_jsx(ShelfGrid,{shelves:filteredShelves,onShelfClick:setSelectedShelf}),selectedShelf&&/*#__PURE__*/_jsx(ShelfDetail,{shelf:selectedShelf,onClose:()=>setSelectedShelf(null)})]});};export default Dashboard;","map":{"version":3,"names":["React","useState","useEffect","ShelfGrid","FilterPanel","ShelfDetail","shelf","jsx","_jsx","jsxs","_jsxs","Dashboard","_ref","user","onLogout","shelves","setShelves","filteredShelves","setFilteredShelves","selectedShelf","setSelectedShelf","filters","setFilters","tier","status","loading","setLoading","error","setError","applyFilters","shelfList","currentFilters","Array","isArray","filter","tierMatch","String","statusMatch","isMounted","loadData","data","fetchAll","filtered","err","message","unsub","subscribe","subscribeToUpdates","update","prevShelves","newShelves","map","s","tray","_objectSpread","handleFilterChange","type","value","newFilters","nextFilters","className","role","children","username","onClick","tiers","Set","sort","statuses","onFilterChange","onShelfClick","onClose"],"sources":["C:/Documents/warehouse-dashboard/src/pages/Dashboard.js"],"sourcesContent":["// File: Dashboard.js\n// Mô tả: Component React chính hiển thị dashboard quản lý kho hàng.\n// Chức năng: Quản lý trạng thái, lọc, thống kê, hiển thị lưới kệ, chi tiết kệ, và đồng bộ dữ liệu mock cho toàn bộ hệ thống.\nimport React, { useState, useEffect } from 'react';\nimport './Dashboard.css';\nimport ShelfGrid from '../components/ShelfGrid/ShelfGrid';\nimport FilterPanel from '../components/FilterPanel/FilterPanel';\nimport ShelfDetail from '../components/ShelfDetail/ShelfDetail';\nimport { shelf } from '../utils/api';\n\nconst Dashboard = ({ user, onLogout }) => {\n  const [shelves, setShelves] = useState([]);\n  const [filteredShelves, setFilteredShelves] = useState([]);\n  const [selectedShelf, setSelectedShelf] = useState(null);  const [filters, setFilters] = useState({ tier: 'all', status: 'all' });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Loại bỏ hàm calculateStats vì không cần thiết nữa\n\n\n  // Áp dụng bộ lọc, an toàn với dữ liệu thiếu\n  const applyFilters = (shelfList, currentFilters) => {\n    return (Array.isArray(shelfList) ? shelfList : []).filter(shelf => {\n      const tierMatch = currentFilters.tier === 'all' || String(shelf.tier) === String(currentFilters.tier);\n      const statusMatch = currentFilters.status === 'all' || (shelf.status && shelf.status === currentFilters.status);\n      return tierMatch && statusMatch;\n    });\n  };\n\n  // Load dữ liệu ban đầu\n  useEffect(() => {\n    let isMounted = true;\n    const loadData = async () => {\n      try {\n        setLoading(true);\n        const data = await shelf.fetchAll();\n        if (!isMounted) return;        setShelves(data);\n        const filtered = applyFilters(data, filters);\n        setFilteredShelves(filtered);\n      } catch (err) {\n        if (isMounted) setError(err.message);\n      } finally {\n        if (isMounted) setLoading(false);\n      }\n    };\n    loadData();\n    return () => { isMounted = false; };\n  }, [filters]);\n\n\n  // Subscribe to shelf updates (mock)\n  useEffect(() => {\n    let unsub = null;\n    const subscribe = async () => {\n      unsub = await shelf.subscribeToUpdates((update) => {\n        setShelves(prevShelves => {\n          const newShelves = prevShelves.map(s =>\n            s.tier === update.tier && s.tray === update.tray\n              ? { ...s, ...update }\n              : s          );\n          const filtered = applyFilters(newShelves, filters);\n          setFilteredShelves(filtered);\n          return newShelves;\n        });\n      });\n    };\n    subscribe();\n    return () => { if (unsub) unsub(); };\n  }, [filters]);\n\n\n  // Xử lý thay đổi bộ lọc\n  const handleFilterChange = (type, value, newFilters) => {\n    // newFilters có thể được truyền từ FilterPanel, nếu không thì tự tạo\n    const nextFilters = newFilters || { ...filters, [type]: value };\n    setFilters(nextFilters);\n    const filtered = applyFilters(shelves, nextFilters);\n    setFilteredShelves(filtered);\n  };\n\n\n  if (loading) {\n    return <div className=\"loading\" role=\"status\">Đang tải dữ liệu...</div>;\n  }\n\n  if (error) {\n    return <div className=\"error\" role=\"alert\">Lỗi: {error}</div>;\n  }\n\n  return (\n    <div className=\"dashboard\">\n      <div className=\"dashboard-header\">\n        <h1 className=\"dashboard-title\">Warehouse Dashboard</h1>\n        <div className=\"user-info\">\n          <span className=\"user-name\">{user?.username || 'Admin'}</span>\n          <button className=\"logout-button\" onClick={onLogout}>\n            Đăng xuất\n          </button>\n        </div>\n      </div>      <FilterPanel \n        tiers={[...new Set(shelves.map(s => s.tier))].sort()}        statuses={['HIGH', 'MEDIUM', 'EMPTY']}\n        filters={filters}\n        onFilterChange={handleFilterChange}\n      />\n      \n      <ShelfGrid \n        shelves={filteredShelves}\n        onShelfClick={setSelectedShelf}\n      />\n      \n      {selectedShelf && (\n        <ShelfDetail \n          shelf={selectedShelf}\n          onClose={() => setSelectedShelf(null)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Dashboard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}